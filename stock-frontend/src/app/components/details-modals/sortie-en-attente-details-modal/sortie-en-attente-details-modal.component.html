<div class="modal-overlay">
  <div class="modal">
    <!-- HEADER -->
    <div class="modal-header">
      <h3 class="modal-title">Détails de la sortie</h3>
      <button class="close-button" (click)="onClose()">&times;</button>
    </div>

    <!-- BODY -->
    <div class="modal-body">
      <app-error *ngIf="error.show" [message]="error.message"></app-error>

      <!-- Common Fields -->
      <form>
        <div class="form-row">
          <div class="form-group">
            <label>Date</label>
            <input
              type="text"
              class="form-control"
              readonly
              [value]="sortie.date"
            />
          </div>
          <div class="form-group">
            <label>Type de Sortie</label>
            <input
              type="text"
              class="form-control"
              readonly
              [value]="getTypeSortieLabel(sortie.typeSortie)"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Magazinier</label>
            <input
              type="text"
              readonly
              class="form-control"
              [value]="sortie.compte.nom + ' ' + sortie.compte.prenom"
            />
          </div>
          <div class="form-group">
            <label>Observation</label>
            <input
              readonly
              type="text"
              class="form-control"
              [value]="sortie.observation || 'Aucune'"
            />
          </div>
        </div>

        <!-- INTERNE DEPOT Fields -->
        <ng-container *ngIf="sortie.typeSortie === 'interne_depot'">
          <div class="form-row">
            <div class="form-group">
              <label>Dépôt</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.depot?.nom || 'Non spécifié'"
              />
            </div>
            <div class="form-group" *ngIf="sortie.nomTransporteurDepot">
              <label>Nom Transporteur</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.nomTransporteurDepot"
              />
            </div>
          </div>
          <div class="form-row" *ngIf="sortie.matriculeTransporteurDepot">
            <div class="form-group">
              <label>Matricule Transporteur</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.matriculeTransporteurDepot"
              />
            </div>
          </div>
        </ng-container>

        <!-- INTERNE CHANTIER Fields -->
        <ng-container *ngIf="sortie.typeSortie === 'interne_chantier'">
          <div class="form-row">
            <div class="form-group">
              <label>Chantier</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.chantier?.nom || 'Non spécifié'"
              />
            </div>
            <div class="form-group" *ngIf="sortie.nomTransporteurChantier">
              <label>Nom Transporteur</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.nomTransporteurChantier"
              />
            </div>
          </div>
          <div class="form-row" *ngIf="sortie.matriculeTransporteurChantier">
            <div class="form-group">
              <label>Matricule Transporteur</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.matriculeTransporteurChantier"
              />
            </div>
          </div>
        </ng-container>

        <!-- EXTERNE Fields -->
        <ng-container *ngIf="sortie.typeSortie === 'externe'">
          <div class="form-row">
            <div class="form-group">
              <label>Nom Entreprise</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.nomEntreprise || 'Non spécifié'"
              />
            </div>
            <div class="form-group">
              <label>Nom Client</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.nomClient || 'Non spécifié'"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Adresse Entreprise</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.adresseEntreprise || 'Non spécifié'"
              />
            </div>
            <div class="form-group">
              <label>Matricule Fiscal</label>
              <input
                readonly
                type="text"
                class="form-control"
                [value]="sortie.matriculeFiscalEntreprise || 'Non spécifié'"
              />
            </div>
          </div>

          <!-- Externe AVEC Transporteur -->
          <ng-container *ngIf="sortie.sousTypeSortieExterne === 'avec_transporteur'">
            <div class="form-row">
              <div class="form-group">
                <label>Nom Transporteur</label>
                <input
                  readonly
                  type="text"
                  class="form-control"
                  [value]="sortie.nomTransporteurExterne || 'Non spécifié'"
                />
              </div>
              <div class="form-group">
                <label>Matricule Transporteur</label>
                <input
                  readonly
                  type="text"
                  class="form-control"
                  [value]="sortie.matriculeTransporteurExterne || 'Non spécifié'"
                />
              </div>
            </div>
          </ng-container>
        </ng-container>
      </form>
    </div>

    <!-- FOOTER with Approve/Deny buttons -->
    <div class="modal-footer">
      <div style="margin-right: auto">
        <button class="button red-button" (click)="confirmationModal = true">
          Refuser
        </button>
      </div>
      <button class="button green-button" (click)="confirmer()">
        Approuver
      </button>
    </div>
  </div>
</div>

<div *ngIf="confirmationModal">
  <app-confirm-delete
    [resource]="'sortie'"
    (close)="confirmationModal = false"
    (confirm)="refuser()"
  ></app-confirm-delete>
</div>
